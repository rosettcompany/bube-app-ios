(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{dwd6:function(e,a,o){"use strict";o.r(a),o.d(a,"LoadingPageModule",(function(){return u}));var t=o("ofXK"),i=o("3Pt+"),r=o("TEn/"),s=o("tyNb"),c=o("mrSG"),n=o("fXoL"),d=o("CmMg");const l=[{path:"",component:(()=>{class e{constructor(e,a,o,t,i,r){this.apiServicio=e,this.router=a,this.platform=o,this.navCtrl=t,this.route=i,this.alertController=r,this.compra=[],this.route.queryParams.subscribe(e=>{this.router.getCurrentNavigation().extras.state&&(this.id=this.router.getCurrentNavigation().extras.state.token,this.cardTipo=a.getCurrentNavigation().extras.state.cardTipo,this.delivery=this.router.getCurrentNavigation().extras.state.delivery,console.log(this.id))})}ngOnInit(){}ionViewDidEnter(){this.subscription=this.platform.backButton.subscribeWithPriority(9999,()=>{}),this.apiServicio.getStorage("ahorro").then(e=>{this.ahorro=e}),console.log("estodo si"),this.apiServicio.getStorage("tarjeta").then(e=>{console.log(e),this.tarjeta=e,this.apiServicio.getDatosUsuario(this.tarjeta.idusuario).subscribe(e=>{this.apiServicio.getStorage("carrito").then(a=>{let o=[];console.log(JSON.stringify(a));for(let e of a.bebidas){let a={id:String(e.idbebida),title:e.nombre,description:e.nombrebebida,pictureUrl:e.rutaimagenbebida,quantity:e.cantidad,unitPrice:e.preciobebidasocio};o.push(a)}this.enviarToken(e,o,a.nombrecomercial)}).catch(e=>{console.log(e)})},e=>{console.log(e)})})}ionViewDidLeave(){this.subscription.unsubscribe()}enviarToken(e,a,o){this.apiServicio.getStorage("total").then(t=>{this.total=t,console.log("token"),this.token={token:this.id,descripcion:"Compra bube",tipo:this.cardTipo,email:e[0].emailusuario,total:t,idusuario:o,dni:e[0].dni,nombreUsuario:e[0].nombresusuario,apellidoUsuario:e[0].apellidosusuario,item:a},console.log(this.token),this.apiServicio.enviarTokerTarjeta(this.token).then(e=>{this.estado=e,console.log("estatus token"),console.log(this.estado),"approved"==this.estado.status?this.construiCarrito():this.mostrarMensajes()}).catch(e=>{console.log(e)})})}construiCarrito(){this.apiServicio.getStorage("carrito").then(e=>{var a;a=e,this.apiServicio.getStorage("ubicacion").then(e=>{var o=String(this.tarjeta.numero).substring(String(this.tarjeta.numero).length-4,String(this.tarjeta.numero).length),t=String(this.tarjeta.tipo+"-"+o);this.carrito={idusuario:this.tarjeta.idusuario,idsociocomercial:a.idsociocomercial,fechacompra:"2020-10-24",tipopagocompra:t,montocompra:Number(this.total),estadocompra:0,ahorrocompra:this.ahorro,modalidad:Number(a.modalidad),direccion_usuario:e},console.log(this.carrito),this.guardarCompra(this.carrito,a),this.apiServicio.getStorage("regalo").then(e=>{0!=Number(e)?(this.guardarNotificacion(this.tarjeta.idusuario),this.guardarNotificacionAmigo(this.tarjeta.idusuario)):console.log("no es regalo")}).catch(e=>{console.log("error al sacar amigo")})}).catch(e=>{console.log(e)})})}guardarCompra(e,a){this.apiServicio.guardarCompra(e).then(e=>{var o=e[0].idcompra;console.log(o);var t=[];for(let i of a.bebidas)t.push("promocion"==i.tipo?{idcompra:o,idbebida:0,subtotal:i.preciobebidasocio,cantidad:i.cantidad,idpromocion:i.idbebida}:{idcompra:o,idbebida:i.idbebida,subtotal:i.preciobebidasocio,cantidad:i.cantidad,idpromocion:"P0"});this.detalle={idcompra:o,listaDetalle:JSON.stringify(t)},this.guardarDetalleCompra(this.detalle,a)}).catch(e=>{console.log("error comprobante"),console.log(e)})}guardarDetalleCompra(e,a){console.log(e),this.apiServicio.guardarDetalleCompra(e).then(e=>{console.log(e),this.compra=e,console.log(this.compra),this.router.navigate(["comprobante"],{state:{compra:this.compra,car:a,tipotarjeta:this.tarjeta.tipo,delivery:this.delivery}})}).catch(e=>{console.log("error detalle compra"),console.log(e)})}guardarNotificacion(e){this.apiServicio.getDatosUsuario(e).subscribe(a=>{let o=a[0];this.apiServicio.getStorage("amigo").then(a=>{this.apiServicio.insertarNotificacion({usuario:{idUsuario:e},idnotificacion:1,descripcion:o.nombresusuario+" enviaste un regalo a "+a,fecha_notificacion:"2020-10-24",fecha_fin:"2020-10-24"}).then(e=>{console.log(e)}).catch(e=>{console.log(e),console.log("error insertar notificacion")})}).catch(e=>{console.log("error al sacar regalo")})},e=>{console.log(e)})}guardarNotificacionAmigo(e){this.apiServicio.getDatosUsuario(e).subscribe(e=>{let a=e[0];this.apiServicio.getStorage("regalo").then(e=>{this.apiServicio.getStorage("amigo").then(o=>{this.apiServicio.insertarNotificacion({usuario:{idUsuario:e},idnotificacion:1,descripcion:o+" acabas de recibir un regalo de "+a.nombresusuario,fecha_notificacion:"2020-10-24",fecha_fin:"2020-10-24"}).then(e=>{console.log(e)}).catch(e=>{console.log(e),console.log("error insertar notificacion")})}).catch(e=>{console.log("error al sacar amigo")})}).catch(e=>{console.log("error al sacar regalo")})},e=>{console.log(e)})}mostrarMensajes(){if("in_process"==this.estado.status)switch(this.estado.statusDetail){case"pending_contingency":this.presentAlertPagoPendiente("Estamos procesando tu pago.","No te preocupes, menos de 2 d\xedas h\xe1biles te avisaremos por e-mail si se acredit\xf3.");break;case"pending_review_manual":this.presentAlertPagoPendiente("Estamos procesando tu pago.","No te preocupes, menos de 2 d\xedas h\xe1biles te avisaremos por e-mail si se acredit\xf3 o si necesitamos m\xe1s informaci\xf3n.")}else if("rejected"==this.estado.status){let e,a;switch(this.estado.statusDetail){case"cc_rejected_bad_filled_card_number":e="Tu pago fue rechazado.",a="Revisa el n\xfamero de tarjeta.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_bad_filled_date":e="Tu pago fue rechazado.",a="Revisa la fecha de vencimiento.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_bad_filled_other":e="Tu pago fue rechazado.",a="Revisa los datos de su tarjeta que esten correctos.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_bad_filled_security_code":e="Tu pago fue rechazado.",a="Revisa el c\xf3digo de seguridad de la tarjeta.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_blacklist":e="Tu pago fue rechazado.",a="No pudimos procesar tu pago.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_call_for_authorize":e="Tu pago fue rechazado.",a="Debes autorizar ante su entidad bancaria el pago realizado.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_card_disabled":e="Tu pago fue rechazado.",a="Llama a su entidad bancaria para activar tu tarjeta o usa otro medio de pago.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_card_error":e="Tu pago fue rechazado.",a="No pudimos procesar tu pago.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_duplicated_payment":e="Tu pago fue rechazado.",a="Ya hiciste un pago por ese valor. Si necesitas volver a pagar usa otra tarjeta u otro medio de pago.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_high_risk":e="Tu pago fue rechazado.",a="Elige otro de los medios de pago, te recomendamos con medios en efectivo.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_insufficient_amount":e="Tu pago fue rechazado.",a="No tienes fondos suficientes.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_invalid_installments":e="Tu pago fue rechazado.",a="Su cuenta no procesa pagos en cuotas.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_max_attempts":e="Tu pago fue rechazado.",a="Llegaste al l\xedmite de intentos permitidos. Elige otra tarjeta u otro medio de pago.",this.presentAlertPagoRechasado(e,a);break;case"cc_rejected_other_reason":e="Tu pago fue rechazado.",a="Tu tarjeta no proces\xf3 el pago.",this.presentAlertPagoRechasado(e,a)}}else this.presentAlertPagoRechasado("Error en el servicio","Obtuvimos un problema en el servidor.")}presentAlertPagoPendiente(e,a){return Object(c.a)(this,void 0,void 0,(function*(){const o=yield this.alertController.create({cssClass:"my-custom-class",header:e,message:a,backdropDismiss:!1,buttons:[{text:"Salir",handler:()=>{this.router.navigate(["./app/inicio"])}}]});yield o.present()}))}presentAlertPagoRechasado(e,a){return Object(c.a)(this,void 0,void 0,(function*(){const o=yield this.alertController.create({cssClass:"my-custom-class",header:e,message:a,backdropDismiss:!1,buttons:[{text:"Regresar",handler:()=>{this.navCtrl.back()}}]});yield o.present()}))}}return e.\u0275fac=function(a){return new(a||e)(n.Ib(d.a),n.Ib(s.g),n.Ib(r.mb),n.Ib(r.lb),n.Ib(s.a),n.Ib(r.a))},e.\u0275cmp=n.Cb({type:e,selectors:[["app-loading"]],decls:7,vars:0,consts:[["color","warning","name","circles"]],template:function(e,a){1&e&&(n.Mb(0,"ion-content"),n.Mb(1,"div"),n.Jb(2,"ion-spinner",0),n.Mb(3,"h4"),n.uc(4,"Por favor espere"),n.Lb(),n.Mb(5,"p"),n.uc(6,"Estamos procesando tu pago"),n.Lb(),n.Lb(),n.Lb())},directives:[r.q,r.Z],styles:["ion-content[_ngcontent-%COMP%]{--background:#686767;position:relative}div[_ngcontent-%COMP%]{text-align:center;align-items:center;align-content:center;position:absolute;top:50%;left:50%;height:30%;width:50%;margin:-15% 0 0 -25%}div[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{transform:scale(6);margin-bottom:50px}div[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-family:Gotham-Medium;color:#fff}div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#c4c4c4;font-family:SFUIDisplay-Regular;font-size:20px;margin-top:10px}"]}),e})()}];let h=(()=>{class e{}return e.\u0275mod=n.Gb({type:e}),e.\u0275inj=n.Fb({factory:function(a){return new(a||e)},imports:[[s.i.forChild(l)],s.i]}),e})(),u=(()=>{class e{}return e.\u0275mod=n.Gb({type:e}),e.\u0275inj=n.Fb({factory:function(a){return new(a||e)},imports:[[t.c,i.d,r.gb,h]]}),e})()}}]);