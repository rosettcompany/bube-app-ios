!function(){function e(e,a){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,a){if(!e)return;if("string"==typeof e)return o(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o(e,a)}(e))||a&&e&&"number"==typeof e.length){t&&(e=t);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,c=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return c=e.done,e},e:function(e){s=!0,n=e},f:function(){try{c||null==t.return||t.return()}finally{if(s)throw n}}}}function o(e,o){(null==o||o>e.length)&&(o=e.length);for(var a=0,t=new Array(o);a<o;a++)t[a]=e[a];return t}function a(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function t(e,o){for(var a=0;a<o.length;a++){var t=o[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{dwd6:function(o,r,i){"use strict";i.r(r),i.d(r,"LoadingPageModule",(function(){return v}));var n,c,s,u=i("ofXK"),l=i("3Pt+"),d=i("TEn/"),p=i("tyNb"),g=i("mrSG"),f=i("fXoL"),h=i("CmMg"),m=[{path:"",component:(n=function(){function o(e,t,r,i,n,c){var s=this;a(this,o),this.apiServicio=e,this.router=t,this.platform=r,this.navCtrl=i,this.route=n,this.alertController=c,this.compra=[],this.route.queryParams.subscribe((function(e){s.router.getCurrentNavigation().extras.state&&(s.id=s.router.getCurrentNavigation().extras.state.token,s.cardTipo=t.getCurrentNavigation().extras.state.cardTipo,s.delivery=s.router.getCurrentNavigation().extras.state.delivery,console.log(s.id))}))}var r,i,n;return r=o,(i=[{key:"ngOnInit",value:function(){}},{key:"ionViewDidEnter",value:function(){var o=this;this.subscription=this.platform.backButton.subscribeWithPriority(9999,(function(){})),this.apiServicio.getStorage("ahorro").then((function(e){o.ahorro=e})),console.log("estodo si"),this.apiServicio.getStorage("tarjeta").then((function(a){console.log(a),o.tarjeta=a,o.apiServicio.getDatosUsuario(o.tarjeta.idusuario).subscribe((function(a){o.apiServicio.getStorage("carrito").then((function(t){var r=[];console.log(JSON.stringify(t));var i,n=e(t.bebidas);try{for(n.s();!(i=n.n()).done;){var c=i.value,s={id:String(c.idbebida),title:c.nombre,description:c.nombrebebida,pictureUrl:c.rutaimagenbebida,quantity:c.cantidad,unitPrice:c.preciobebidasocio};r.push(s)}}catch(u){n.e(u)}finally{n.f()}o.enviarToken(a,r,t.nombrecomercial)})).catch((function(e){console.log(e)}))}),(function(e){console.log(e)}))}))}},{key:"ionViewDidLeave",value:function(){this.subscription.unsubscribe()}},{key:"enviarToken",value:function(e,o,a){var t=this;this.apiServicio.getStorage("total").then((function(r){t.total=r,console.log("token"),t.token={token:t.id,descripcion:"Compra bube",tipo:t.cardTipo,email:e[0].emailusuario,total:r,idusuario:a,dni:e[0].dni,nombreUsuario:e[0].nombresusuario,apellidoUsuario:e[0].apellidosusuario,item:o},console.log(t.token),t.apiServicio.enviarTokerTarjeta(t.token).then((function(e){t.estado=e,console.log("estatus token"),console.log(t.estado),"approved"==t.estado.status?t.construiCarrito():t.mostrarMensajes()})).catch((function(e){console.log(e)}))}))}},{key:"construiCarrito",value:function(){var e=this;this.apiServicio.getStorage("carrito").then((function(o){var a;a=o,e.apiServicio.getStorage("ubicacion").then((function(o){var t=String(e.tarjeta.numero).substring(String(e.tarjeta.numero).length-4,String(e.tarjeta.numero).length),r=String(e.tarjeta.tipo+"-"+t);e.carrito={idusuario:e.tarjeta.idusuario,idsociocomercial:a.idsociocomercial,fechacompra:"2020-10-24",tipopagocompra:r,montocompra:Number(e.total),estadocompra:0,ahorrocompra:e.ahorro,modalidad:Number(a.modalidad),direccion_usuario:o},console.log(e.carrito),e.guardarCompra(e.carrito,a),e.apiServicio.getStorage("regalo").then((function(o){0!=Number(o)?(e.guardarNotificacion(e.tarjeta.idusuario),e.guardarNotificacionAmigo(e.tarjeta.idusuario)):console.log("no es regalo")})).catch((function(e){console.log("error al sacar amigo")}))})).catch((function(e){console.log(e)}))}))}},{key:"guardarCompra",value:function(o,a){var t=this;this.apiServicio.guardarCompra(o).then((function(o){var r=o[0].idcompra;console.log(r);var i,n=[],c=e(a.bebidas);try{for(c.s();!(i=c.n()).done;){var s=i.value;n.push("promocion"==s.tipo?{idcompra:r,idbebida:0,subtotal:s.preciobebidasocio,cantidad:s.cantidad,idpromocion:s.idbebida}:{idcompra:r,idbebida:s.idbebida,subtotal:s.preciobebidasocio,cantidad:s.cantidad,idpromocion:"P0"})}}catch(u){c.e(u)}finally{c.f()}t.detalle={idcompra:r,listaDetalle:JSON.stringify(n)},t.guardarDetalleCompra(t.detalle,a)})).catch((function(e){console.log("error comprobante"),console.log(e)}))}},{key:"guardarDetalleCompra",value:function(e,o){var a=this;console.log(e),this.apiServicio.guardarDetalleCompra(e).then((function(e){console.log(e),a.compra=e,console.log(a.compra),a.router.navigate(["comprobante"],{state:{compra:a.compra,car:o,tipotarjeta:a.tarjeta.tipo,delivery:a.delivery}})})).catch((function(e){console.log("error detalle compra"),console.log(e)}))}},{key:"guardarNotificacion",value:function(e){var o=this;this.apiServicio.getDatosUsuario(e).subscribe((function(a){var t=a[0];o.apiServicio.getStorage("amigo").then((function(a){o.apiServicio.insertarNotificacion({usuario:{idUsuario:e},idnotificacion:1,descripcion:t.nombresusuario+" enviaste un regalo a "+a,fecha_notificacion:"2020-10-24",fecha_fin:"2020-10-24"}).then((function(e){console.log(e)})).catch((function(e){console.log(e),console.log("error insertar notificacion")}))})).catch((function(e){console.log("error al sacar regalo")}))}),(function(e){console.log(e)}))}},{key:"guardarNotificacionAmigo",value:function(e){var o=this;this.apiServicio.getDatosUsuario(e).subscribe((function(e){var a=e[0];o.apiServicio.getStorage("regalo").then((function(e){o.apiServicio.getStorage("amigo").then((function(t){o.apiServicio.insertarNotificacion({usuario:{idUsuario:e},idnotificacion:1,descripcion:t+" acabas de recibir un regalo de "+a.nombresusuario,fecha_notificacion:"2020-10-24",fecha_fin:"2020-10-24"}).then((function(e){console.log(e)})).catch((function(e){console.log(e),console.log("error insertar notificacion")}))})).catch((function(e){console.log("error al sacar amigo")}))})).catch((function(e){console.log("error al sacar regalo")}))}),(function(e){console.log(e)}))}},{key:"mostrarMensajes",value:function(){if("in_process"==this.estado.status)switch(this.estado.statusDetail){case"pending_contingency":this.presentAlertPagoPendiente("Estamos procesando tu pago.","No te preocupes, menos de 2 d\xedas h\xe1biles te avisaremos por e-mail si se acredit\xf3.");break;case"pending_review_manual":this.presentAlertPagoPendiente("Estamos procesando tu pago.","No te preocupes, menos de 2 d\xedas h\xe1biles te avisaremos por e-mail si se acredit\xf3 o si necesitamos m\xe1s informaci\xf3n.")}else if("rejected"==this.estado.status){var e,o;switch(this.estado.statusDetail){case"cc_rejected_bad_filled_card_number":e="Tu pago fue rechazado.",o="Revisa el n\xfamero de tarjeta.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_bad_filled_date":e="Tu pago fue rechazado.",o="Revisa la fecha de vencimiento.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_bad_filled_other":e="Tu pago fue rechazado.",o="Revisa los datos de su tarjeta que esten correctos.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_bad_filled_security_code":e="Tu pago fue rechazado.",o="Revisa el c\xf3digo de seguridad de la tarjeta.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_blacklist":e="Tu pago fue rechazado.",o="No pudimos procesar tu pago.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_call_for_authorize":e="Tu pago fue rechazado.",o="Debes autorizar ante su entidad bancaria el pago realizado.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_card_disabled":e="Tu pago fue rechazado.",o="Llama a su entidad bancaria para activar tu tarjeta o usa otro medio de pago.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_card_error":e="Tu pago fue rechazado.",o="No pudimos procesar tu pago.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_duplicated_payment":e="Tu pago fue rechazado.",o="Ya hiciste un pago por ese valor. Si necesitas volver a pagar usa otra tarjeta u otro medio de pago.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_high_risk":e="Tu pago fue rechazado.",o="Elige otro de los medios de pago, te recomendamos con medios en efectivo.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_insufficient_amount":e="Tu pago fue rechazado.",o="No tienes fondos suficientes.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_invalid_installments":e="Tu pago fue rechazado.",o="Su cuenta no procesa pagos en cuotas.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_max_attempts":e="Tu pago fue rechazado.",o="Llegaste al l\xedmite de intentos permitidos. Elige otra tarjeta u otro medio de pago.",this.presentAlertPagoRechasado(e,o);break;case"cc_rejected_other_reason":e="Tu pago fue rechazado.",o="Tu tarjeta no proces\xf3 el pago.",this.presentAlertPagoRechasado(e,o)}}else this.presentAlertPagoRechasado("Error en el servicio","Obtuvimos un problema en el servidor.")}},{key:"presentAlertPagoPendiente",value:function(e,o){return Object(g.a)(this,void 0,void 0,regeneratorRuntime.mark((function a(){var t,r=this;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.alertController.create({cssClass:"my-custom-class",header:e,message:o,backdropDismiss:!1,buttons:[{text:"Salir",handler:function(){r.router.navigate(["./app/inicio"])}}]});case 2:return t=a.sent,a.next=5,t.present();case 5:case"end":return a.stop()}}),a,this)})))}},{key:"presentAlertPagoRechasado",value:function(e,o){return Object(g.a)(this,void 0,void 0,regeneratorRuntime.mark((function a(){var t,r=this;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.alertController.create({cssClass:"my-custom-class",header:e,message:o,backdropDismiss:!1,buttons:[{text:"Regresar",handler:function(){r.navCtrl.back()}}]});case 2:return t=a.sent,a.next=5,t.present();case 5:case"end":return a.stop()}}),a,this)})))}}])&&t(r.prototype,i),n&&t(r,n),o}(),n.\u0275fac=function(e){return new(e||n)(f.Ib(h.a),f.Ib(p.g),f.Ib(d.mb),f.Ib(d.lb),f.Ib(p.a),f.Ib(d.a))},n.\u0275cmp=f.Cb({type:n,selectors:[["app-loading"]],decls:7,vars:0,consts:[["color","warning","name","circles"]],template:function(e,o){1&e&&(f.Mb(0,"ion-content"),f.Mb(1,"div"),f.Jb(2,"ion-spinner",0),f.Mb(3,"h4"),f.uc(4,"Por favor espere"),f.Lb(),f.Mb(5,"p"),f.uc(6,"Estamos procesando tu pago"),f.Lb(),f.Lb(),f.Lb())},directives:[d.q,d.Z],styles:["ion-content[_ngcontent-%COMP%]{--background:#686767;position:relative}div[_ngcontent-%COMP%]{text-align:center;align-items:center;align-content:center;position:absolute;top:50%;left:50%;height:30%;width:50%;margin:-15% 0 0 -25%}div[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{transform:scale(6);margin-bottom:50px}div[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-family:Gotham-Medium;color:#fff}div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#c4c4c4;font-family:SFUIDisplay-Regular;font-size:20px;margin-top:10px}"]}),n)}],b=((s=function e(){a(this,e)}).\u0275mod=f.Gb({type:s}),s.\u0275inj=f.Fb({factory:function(e){return new(e||s)},imports:[[p.i.forChild(m)],p.i]}),s),v=((c=function e(){a(this,e)}).\u0275mod=f.Gb({type:c}),c.\u0275inj=f.Fb({factory:function(e){return new(e||c)},imports:[[u.c,l.d,d.gb,b]]}),c)}}])}();