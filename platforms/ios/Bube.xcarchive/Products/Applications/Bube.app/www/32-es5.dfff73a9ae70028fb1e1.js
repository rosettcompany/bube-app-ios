!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{"Y+Q8":function(t,n,i){"use strict";i.r(n),i.d(n,"FinalizarCompraPageModule",(function(){return y}));var r,a=i("ofXK"),s=i("3Pt+"),l=i("TEn/"),u=i("tyNb"),c=i("mrSG"),b=i("fXoL"),d=i("CmMg"),g=((r=function(){function t(o,n,i,r){e(this,t),this.toastController=o,this.apiServicio=n,this.platform=i,this.popoverController=r}return o(t,[{key:"ngOnInit",value:function(){}},{key:"ionViewDidEnter",value:function(){var e=this;console.log(this.usuario),this.subscription=this.platform.backButton.subscribeWithPriority(9999,(function(){e.cerrar()}))}},{key:"pagar",value:function(){var e=this,t=document.getElementById("txt-numero");8==String(t.value).length?(console.log(String(t.value).substring(0,1)),console.log(String(t.value).substring(1,2)),console.log(String(t.value).substring(2,3)),console.log(String(t.value).substring(3,4)),console.log(String(t.value).substring(4,5)),console.log(String(t.value).substring(5,6)),console.log(String(t.value).substring(6,7)),console.log(String(t.value).substring(7,8)),isNaN(Number(String(t.value).substring(0,1)))||isNaN(Number(String(t.value).substring(1,2)))||isNaN(Number(String(t.value).substring(2,3)))||isNaN(Number(String(t.value).substring(3,4)))||isNaN(Number(String(t.value).substring(4,5)))||isNaN(Number(String(t.value).substring(5,6)))||isNaN(Number(String(t.value).substring(6,7)))||isNaN(Number(String(t.value).substring(7,8)))?this.presentToast("DNI invalido"):(this.usuario.dni=t.value,console.log(this.usuario),this.user={apellidosUsuario:this.usuario.apellidosusuario,codigoPais:this.usuario.codigopais,dni:t.value,email2Usuario:this.usuario.email2usuario,emailUsuario:this.usuario.emailusuario,estadoUsuario:this.usuario.estadousuario,fechaNacimientoUsuario:this.usuario.fechanacimientousuario,fechaRegistro:this.usuario.fecharegistro,idFacebook:this.usuario.idfacebook,idUsuario:this.usuario.idusuario,nombresUsuario:this.usuario.nombresusuario,rutaFotoUsuario:this.usuario.rutafotousuario,sexoUsuario:this.usuario.sexousuario,telefonoUsuario:this.usuario.telefonousuario},this.apiServicio.insertarDni(this.user).then((function(t){console.log(t),e.popoverController.dismiss({usuario:e.user})})).catch((function(e){console.log("error al insertar dni"),console.log(e)})))):(this.presentToast("Ingrese su DNI"),console.log("toast"))}},{key:"presentToast",value:function(e){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.toastController.create({message:e,duration:2e3,color:"danger"});case 2:t.sent.present();case 3:case"end":return t.stop()}}),t,this)})))}},{key:"cerrar",value:function(){this.popoverController.dismiss(),this.subscription.unsubscribe()}}]),t}()).\u0275fac=function(e){return new(e||r)(b.Ib(l.sb),b.Ib(d.a),b.Ib(l.mb),b.Ib(l.nb))},r.\u0275cmp=b.Cb({type:r,selectors:[["app-popinfo"]],decls:9,vars:0,consts:[["size","large","name","close-circle-outline",3,"click"],["type","tel","inputmode","numeric","pattern","[0-9]","maxlength","8","id","txt-numero","placeholder","DNI"],[3,"click"]],template:function(e,t){1&e&&(b.Mb(0,"ion-content"),b.Mb(1,"div"),b.Mb(2,"ion-icon",0),b.Ub("click",(function(){return t.cerrar()})),b.Lb(),b.Lb(),b.Mb(3,"div"),b.Mb(4,"ion-label"),b.uc(5,"Ingrese su Documento de identidad(DNI)"),b.Lb(),b.Jb(6,"ion-input",1),b.Mb(7,"ion-button",2),b.Ub("click",(function(){return t.pagar()})),b.uc(8,"Pagar"),b.Lb(),b.Lb(),b.Lb())},directives:[l.q,l.w,l.G,l.A,l.rb,l.h],styles:["ion-content[_ngcontent-%COMP%], ion-label[_ngcontent-%COMP%]{text-align:center}ion-label[_ngcontent-%COMP%]{margin-top:10px;color:#000;justify-content:center;font-size:18px;font-family:Gotham-Medium}ion-icon[_ngcontent-%COMP%]{margin-left:80%;color:red}ion-input[_ngcontent-%COMP%]{margin-top:20px;margin-left:5%;margin-right:5%;border:1px solid #108b3c;border-radius:10px;color:#000;background:#fff}ion-button[_ngcontent-%COMP%], ion-input[_ngcontent-%COMP%]{width:90%;height:40px}ion-button[_ngcontent-%COMP%]{margin:20px 5% 10px;border-radius:10px;color:#fff;--background:#108b3c}"]}),r),p=i("M2bA");function h(e,t){if(1&e&&(b.Mb(0,"ion-item",12),b.Mb(1,"ion-col"),b.Mb(2,"ion-row"),b.Mb(3,"p",7),b.uc(4),b.Lb(),b.Lb(),b.Mb(5,"ion-row"),b.Mb(6,"ion-label",5),b.uc(7),b.Lb(),b.Lb(),b.Mb(8,"ion-row"),b.Mb(9,"ion-label",13),b.uc(10),b.Mb(11,"span",14),b.uc(12," Disponible"),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Jb(13,"img",15),b.Lb()),2&e){var o=t.$implicit;b.yb(4),b.vc(o.nombrebebida),b.yb(3),b.vc(o.nombrecomercial),b.yb(3),b.wc("S/ ",o.preciobebidasocio.toFixed(2)," \xb0 "),b.yb(3),b.fc("src",o.rutaimagenbebida,b.nc)}}var f,m,v,M=[{path:"",component:(f=function(){function t(o,n,i,r,a,s,l,u,c,b){var d=this;e(this,t),this.router=o,this.route=n,this.modalControler=i,this.platform=r,this.popoverController=a,this.navCtrl=s,this.firebaseAnalytics=l,this.apiServicio=u,this.alertController=c,this.loadingController=b,this.modalidad="Recojo",this.total=0,this.buttonDisabled="false",Mercadopago.setPublishableKey("APP_USR-e710be6c-9f94-4ec3-8830-5df20b925910"),this.route.queryParams.subscribe((function(e){d.router.getCurrentNavigation().extras.state&&(d.carrito=d.router.getCurrentNavigation().extras.state.carrito,d.total=d.router.getCurrentNavigation().extras.state.total,d.tarjeta=d.router.getCurrentNavigation().extras.state.tarjeta,d.delivery=d.router.getCurrentNavigation().extras.state.delivery,console.log(d.carrito),console.log(d.total),console.log("TARJETA"),console.log(d.tarjeta))}))}return o(t,[{key:"ngOnInit",value:function(){}},{key:"ionViewDidEnter",value:function(){"1"==this.delivery.modalidad?(this.modalidad="Delivery",this.indicadorModalidad="S/ "+this.delivery.precio.toFixed(2)):(this.modalidad="Recojo",this.indicadorModalidad=this.carrito.direccionsocio);var e=String(this.tarjeta.tipo).substring(0,1),t=String(this.tarjeta.tipo).substring(1);console.log(e),console.log(t),this.tipo=e.toLocaleUpperCase()+t,this.num_tarjeta=String(this.tarjeta.numero).substring(String(this.tarjeta.numero).length-4,String(this.tarjeta.numero).length),console.log(this.num_tarjeta),this.googleAnalytics()}},{key:"ionViewDidLeave",value:function(){this.subscription.unsubscribe(),this.popoverController.dismiss(0),this.buttonDisabled="false"}},{key:"presentLoading",value:function(){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadingController.create({cssClass:"my-custom-class",message:"Cargando.."});case 2:return this.loading=e.sent,e.next=5,this.loading.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"comprobarDni",value:function(){var e=this;this.buttonDisabled="true",this.apiServicio.getStorage("idusuario").then((function(t){e.apiServicio.getDatosUsuario(t).subscribe((function(t){e.usuario=t[0],console.log(e.usuario),null==e.usuario.dni?e.abrirPop(e.usuario):e.pagar()}),(function(t){console.log("error al traer datos usuario"),console.log(t),e.buttonDisabled="false",e.alertaConexion()}))}))}},{key:"abrirPop",value:function(e){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var o,n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.popoverController.create({component:g,backdropDismiss:!1,componentProps:{usuario:e}});case 2:return o=t.sent,t.next=5,o.present();case 5:return t.next=7,o.onDidDismiss();case 7:n=t.sent,i=n.data,this.buttonDisabled="false",0!=i.usuario&&(this.usuario=i.usuario,console.log(this.usuario),this.pagar());case 10:case"end":return t.stop()}}),t,this)})))}},{key:"pagar",value:function(){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,o,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.presentLoading(),this.subscription=this.platform.backButton.subscribeWithPriority(9999,(function(){})),this.apiServicio.setStorage("tarjeta",this.tarjeta),this.apiServicio.setStorage("total",this.total),this.apiServicio.setStorage("carrito",this.carrito),t=String(this.tarjeta.fecha).split("/",2),o=t[0],n=20+t[1],Mercadopago.clearSession(),console.log(this.tarjeta.numero),console.log(this.usuario),i=String(this.tarjeta.numero).substring(0,6),Mercadopago.getPaymentMethod({bin:i},this.setPaymentMethod),Mercadopago.createToken({docType:"DNI",docNumber:this.usuario.dni,cardNumber:this.tarjeta.numero,securityCode:this.tarjeta.cvv,cardExpirationMonth:o,cardExpirationYear:n,cardholderName:this.tarjeta.titular,installments:1},this.sdkResponseHandler);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"setPaymentMethod",value:function(e,t){200==e?(console.log(t),document.getElementById("txt-tipo").value=t[0].id):alert("payment method info error: "+t)}},{key:"sdkResponseHandler",value:function(e,t){if(200!=e&&201!=e){var o=document.getElementById("txt-token");console.log(o.value),o.value=t.cause[0].code,console.log(o.value),console.log("status "+t.cause[0].code),console.log(t)}else{var n=document.getElementById("txt-token");console.log(t),console.log(e),n.value=t.id}}},{key:"enviarDatosPago",value:function(){var e=document.getElementById("txt-token");if(console.log(e.value),String(e.value).length<=4)switch(this.loading.dismiss(),e.value){case"E301":this.presentAlertConfirm("Ingresa un n\xfamero de tarjeta v\xe1lido."),this.buttonDisabled="false";break;case"E302":this.presentAlertConfirm("Revisa el c\xf3digo de seguridad(CVV)"),this.buttonDisabled="false";break;case"316":this.presentAlertConfirm("Ingresa un nombre v\xe1lido"),this.buttonDisabled="false";break;case"324":this.presentAlertConfirm("Ingresa tu documento valido"),this.buttonDisabled="false";break;case"325":this.presentAlertConfirm("El mes es inv\xe1lido"),this.buttonDisabled="false";break;case"326":this.presentAlertConfirm("El a\xf1o es inv\xe1lido"),this.buttonDisabled="false";break;case"106":this.presentAlertConfirm("No puedes realizar pagos a otros pa\xedses."),this.buttonDisabled="false";break;case"109":this.presentAlertConfirm("no procesa pagos en cuotas. Elige otra tarjeta u otro medio de pago."),this.buttonDisabled="false";break;case"126":this.presentAlertConfirm("No pudimos procesar tu pago."),this.buttonDisabled="false";break;case"129":this.presentAlertConfirm("no procesa pagos del monto seleccionado. Elige otra tarjeta u otro medio de pago."),this.buttonDisabled="false";break;case"145":this.presentAlertConfirm("Una de las partes con la que intentas hacer el pago es de prueba y la otra es usuario real."),this.buttonDisabled="false";break;case"150":case"151":this.presentAlertConfirm("No puedes realizar pagos."),this.buttonDisabled="false";break;case"160":this.presentAlertConfirm("No pudimos procesar tu pago."),this.buttonDisabled="false";break;case"204":this.presentAlertConfirm("No est\xe1 disponible en este momento. Elige otra tarjeta u otro medio de pago."),this.buttonDisabled="false";break;case"801":this.presentAlertConfirm("Realizaste un pago similar hace instantes. Intenta de nuevo en unos minutos."),this.buttonDisabled="false";break;default:this.presentAlertConfirm("No pudimos procesar tu pago. Intentelo m\xe1s tarde"),this.buttonDisabled="false"}else{var t=document.getElementById("txt-tipo"),o={state:{token:e.value,cardTipo:t.value,delivery:this.delivery}};this.loading.dismiss(),this.router.navigate(["loading"],o)}}},{key:"presentAlertConfirm",value:function(e){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var o,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Revisar datos de su tarjeta",message:e,buttons:[{text:"OK",role:"cancel",cssClass:"secondary",handler:function(e){n.navCtrl.back()}}]});case 2:return o=t.sent,t.next=5,o.present();case 5:case"end":return t.stop()}}),t,this)})))}},{key:"alertaConexion",value:function(){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Error de Conexi\xf3n",message:"Por favor Verifique su conexi\xf3n a internet",buttons:[{text:"OK",role:"cancel",cssClass:"secondary",handler:function(e){console.log("Boton no")}}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"regresar",value:function(){document.getElementById("volver3").disabled=!0}},{key:"googleAnalytics",value:function(){this.firebaseAnalytics.logEvent("pantalla",{pantalla:"pasarela_FinalizarCompra"}).then((function(e){console.log(e),console.log("firebase ok")})).catch((function(e){console.log(e),console.log("firebase no")}))}}]),t}(),f.\u0275fac=function(e){return new(e||f)(b.Ib(u.g),b.Ib(u.a),b.Ib(l.kb),b.Ib(l.mb),b.Ib(l.nb),b.Ib(l.lb),b.Ib(p.a),b.Ib(d.a),b.Ib(l.a),b.Ib(l.ib))},f.\u0275cmp=b.Cb({type:f,selectors:[["app-finalizar-compra"]],decls:47,vars:9,consts:[["slot","start",2,"color","#f3f2ed"],["id","volver3",3,"click"],["slot","end"],["style","--border-color:#121212;margin-top: 20px;",4,"ngFor","ngForOf"],[2,"margin-top","60px","--border-color","#ffc30b"],[1,"tienda"],[2,"margin-top","10px","--border-color","#ffc30b"],[1,"descripcion-bebida"],[2,"margin-top","10px","--border-color","#121212"],["id","txt-token","disabled","true",2,"--background","#121212","border","none","color","#121212",3,"ionChange"],["id","txt-tipo","disabled","true",2,"--background","#121212","border","none","color","#121212"],["id","btn-volver","expand","block",3,"disabled","click"],[2,"--border-color","#121212","margin-top","20px"],[1,"precio"],[2,"font-weight","lighter","color","#108b3c"],[3,"src"]],template:function(e,t){1&e&&(b.Mb(0,"ion-header"),b.Mb(1,"ion-toolbar"),b.Mb(2,"ion-buttons",0),b.Mb(3,"ion-back-button",1),b.Ub("click",(function(){return t.regresar()})),b.Lb(),b.Lb(),b.Mb(4,"ion-title"),b.uc(5,"Finalizar compra"),b.Lb(),b.Mb(6,"ion-label",2),b.uc(7),b.Lb(),b.Lb(),b.Lb(),b.Mb(8,"ion-content"),b.Mb(9,"h3"),b.uc(10,"Resumen de tu orden"),b.Lb(),b.sc(11,h,14,4,"ion-item",3),b.Mb(12,"ion-item",4),b.Mb(13,"ion-col"),b.Mb(14,"ion-row"),b.Mb(15,"ion-label",5),b.uc(16),b.Lb(),b.Lb(),b.Lb(),b.Mb(17,"ion-label",5),b.uc(18),b.Lb(),b.Lb(),b.Mb(19,"ion-item",6),b.Mb(20,"ion-col"),b.Mb(21,"ion-row"),b.Mb(22,"ion-label",5),b.uc(23,"M\xe9todo de Pago"),b.Lb(),b.Lb(),b.Lb(),b.Mb(24,"ion-col"),b.Mb(25,"ion-row"),b.Mb(26,"ion-label",7),b.uc(27),b.Lb(),b.Lb(),b.Mb(28,"ion-row"),b.Mb(29,"ion-label",5),b.uc(30),b.Lb(),b.Lb(),b.Mb(31,"ion-row"),b.Jb(32,"ion-label"),b.Lb(),b.Lb(),b.Lb(),b.Mb(33,"ion-item",8),b.Mb(34,"ion-col"),b.Mb(35,"ion-row"),b.Mb(36,"ion-label",7),b.uc(37,"Total"),b.Lb(),b.Lb(),b.Lb(),b.Mb(38,"ion-col"),b.Mb(39,"ion-row"),b.Mb(40,"ion-label",7),b.uc(41),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Mb(42,"ion-input",9),b.Ub("ionChange",(function(){return t.enviarDatosPago()})),b.Lb(),b.Jb(43,"ion-input",10),b.Lb(),b.Mb(44,"ion-footer"),b.Mb(45,"ion-button",11),b.Ub("click",(function(){return t.comprobarDni()})),b.uc(46,"Pagar"),b.Lb(),b.Lb()),2&e&&(b.yb(7),b.wc("S/ ",t.total.toFixed(2),""),b.yb(4),b.ec("ngForOf",t.carrito.bebidas),b.yb(5),b.vc(t.modalidad),b.yb(2),b.vc(t.indicadorModalidad),b.yb(9),b.xc("",t.tipo,"****",t.num_tarjeta,""),b.yb(3),b.wc("vence ",t.tarjeta.fecha,""),b.yb(11),b.wc("S/ ",t.total.toFixed(2),""),b.yb(4),b.fc("disabled",t.buttonDisabled))},directives:[l.v,l.fb,l.i,l.e,l.f,l.eb,l.G,l.q,a.j,l.B,l.p,l.Q,l.A,l.rb,l.t,l.h],styles:["ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background:#108b3c}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{color:#fff;font-family:Gotham-Medium;font-size:23px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#fff;font-family:SFCompactText-Medium;font-size:20px;margin-right:10px}ion-content[_ngcontent-%COMP%], ion-footer[_ngcontent-%COMP%]{--background:#121212}ion-footer[_ngcontent-%COMP%]{background:#121212}ion-item[_ngcontent-%COMP%]{--background:#121212}h3[_ngcontent-%COMP%]{color:#f3f2ed;margin-left:20px;font-family:Gotham-Medium;margin-top:20px}.descripcion-bebida[_ngcontent-%COMP%]{font-weight:700}.descripcion-bebida[_ngcontent-%COMP%], .tienda[_ngcontent-%COMP%]{color:#fff;font-family:SFUIDisplay-Regular;font-size:18px}.tienda[_ngcontent-%COMP%]{font-weight:lighter}.precio[_ngcontent-%COMP%]{color:#fff;font-family:SFUIDisplay-Regular;font-size:18px;font-weight:700;margin-top:10px}img[_ngcontent-%COMP%]{border-radius:10px;margin-left:5px;width:90px;height:90px}#btn-volver[_ngcontent-%COMP%]{--background:#108b3c;margin:20px 30px;--border-radius:10px}#btn-explorar[_ngcontent-%COMP%], #btn-volver[_ngcontent-%COMP%]{font-family:SFCompactText-Medium;--color:#fff;font-size:16px;height:50px}#btn-explorar[_ngcontent-%COMP%]{--background:#222121;margin-left:30px;margin-right:30px;margin-bottom:20px;border:3px solid #108b3c;border-radius:10px}"]}),f)}],C=((v=function t(){e(this,t)}).\u0275mod=b.Gb({type:v}),v.\u0275inj=b.Fb({factory:function(e){return new(e||v)},imports:[[u.i.forChild(M)],u.i]}),v),y=((m=function t(){e(this,t)}).\u0275mod=b.Gb({type:m}),m.\u0275inj=b.Fb({factory:function(e){return new(e||m)},imports:[[a.c,s.d,l.gb,C]]}),m)}}])}();