!function(){function t(t,n){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return e(t,n)}(t))||n&&t&&"number"==typeof t.length){i&&(t=i);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return c=t.done,t},e:function(t){l=!0,r=t},f:function(){try{c||null==i.return||i.return()}finally{if(l)throw r}}}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{CLgd:function(e,o,a){"use strict";a.r(o),a.d(o,"TarjetasPageModule",(function(){return w}));var r=a("ofXK"),c=a("3Pt+"),l=a("TEn/"),s=a("tyNb"),b=a("mrSG"),d=a("yR4b"),u=a("R0Ic"),g=a("fXoL"),f=a("CmMg"),p=a("Q4mC"),h=a("M2bA"),m=["lista"];function v(t,e){1&t&&(g.Mb(0,"ion-row"),g.Mb(1,"div",11),g.Jb(2,"ion-spinner",12),g.Lb(),g.Lb())}function y(t,e){if(1&t){var n=g.Nb();g.Mb(0,"ion-item-sliding"),g.Mb(1,"ion-item"),g.Mb(2,"ion-row"),g.Mb(3,"ion-col"),g.Mb(4,"div"),g.Jb(5,"img",17),g.Jb(6,"img",18),g.Mb(7,"ion-label",19),g.uc(8),g.Lb(),g.Mb(9,"ion-label",20),g.uc(10,"Nombre titular"),g.Lb(),g.Mb(11,"ion-label",21),g.uc(12),g.Lb(),g.Mb(13,"ion-label",22),g.uc(14,"Fecha vencimiento"),g.Lb(),g.Mb(15,"ion-label",23),g.uc(16),g.Lb(),g.Lb(),g.Lb(),g.Mb(17,"ion-col"),g.Mb(18,"ion-item"),g.Mb(19,"ion-label",24),g.uc(20,"Usar como m\xe9todo de pago"),g.Lb(),g.Mb(21,"ion-radio",25),g.Ub("click",(function(){g.mc(n);var t=e.$implicit;return g.Xb(2).EvnetotarjetaSeleccionada(t.numero)})),g.Lb(),g.Lb(),g.Lb(),g.Lb(),g.Lb(),g.Mb(22,"ion-item-options",26),g.Mb(23,"ion-item-option",27),g.Ub("click",(function(){g.mc(n);var t=e.$implicit;return g.Xb(2).editar(t)})),g.Jb(24,"ion-icon",28),g.Lb(),g.Lb(),g.Mb(25,"ion-item-options",29),g.Mb(26,"ion-item-option",27),g.Ub("click",(function(){g.mc(n);var t=e.$implicit;return g.Xb(2).eliminar(t)})),g.Jb(27,"ion-icon",30),g.Lb(),g.Lb(),g.Lb()}if(2&t){var i=e.$implicit,o=g.Xb(2);g.yb(4),g.qc(i.color),g.yb(2),g.gc("src","./assets/Iconos/",i.tipo,".png",g.nc),g.yb(2),g.yc("",o.n1(i.numero)," ",o.n2(i.numero),"*** **** ",o.n3(i.numero),""),g.yb(4),g.vc(i.titular),g.yb(4),g.vc(i.fecha),g.yb(5),g.fc("value",i.numero)}}function M(t,e){if(1&t){var n=g.Nb();g.Mb(0,"ion-list",13,14),g.Mb(2,"ion-radio-group",15),g.Ub("ngModelChange",(function(t){return g.mc(n),g.Xb().tarjetaSeleccionada=t}))("ionChange",(function(t){return g.mc(n),g.Xb().seleccionar(t)})),g.sc(3,y,28,10,"ion-item-sliding",16),g.Lb(),g.Lb()}if(2&t){var i=g.Xb();g.ec("@visibilityChanged",i.animation),g.yb(2),g.ec("ngModel",i.tarjetaSeleccionada),g.yb(1),g.ec("ngForOf",i.tarjetas[0])}}var x,C,j,O=[{path:"",component:(x=function(){function e(t,i,o,a,r,c,l){var s=this;n(this,e),this.router=t,this.apiServicio=i,this.navCtrl=o,this.servicioAES=a,this.firebaseAnalytics=r,this.modalController=c,this.route=l,this.tarjetas=[],this.checkedTaretas=[],this.oculto=!0,this.total=0,this.tiendasAhorro=[],this.spinner=!0,this.animation="hidden",this.tarjetaSeleccionada=0,this.keyJScrypto="123456$#@$^@1ERF",this.route.queryParams.subscribe((function(t){s.router.getCurrentNavigation().extras.state&&(s.carrito=s.router.getCurrentNavigation().extras.state.carrito,s.establecimientosCoincidencia=s.router.getCurrentNavigation().extras.state.establecimientosCoincidencia,s.delivery=s.router.getCurrentNavigation().extras.state.delivery)}))}var o,a,r;return o=e,(a=[{key:"ionViewDidEnter",value:function(){var e=this;this.tarjetaSeleccionada=0,this.oculto=0==this.tarjetaSeleccionada;var n=0;console.log("CARRITO"),console.log(this.carrito),console.log(this.carrito.bebidas);var i,o=t(this.carrito.bebidas);try{for(o.s();!(i=o.n()).done;){var a=i.value;console.log("t"+a.preciobebidasocio),n+=a.cantidad*a.preciobebidasocio}}catch(r){o.e(r)}finally{o.f()}this.t=n,this.carrito.modalidad=this.delivery.modalidad,this.total=Number("1"==this.delivery.modalidad?(this.delivery.precio+n).toFixed(2):n.toFixed(2)),console.log("CANTIDAD SUMADA"),console.log(n),this.apiServicio.getStorage("idusuario").then((function(t){e.obtenerTarjetas(t),console.log(t)})).catch((function(t){console.log("no hay idusuario")})),this.googleAnalytics()}},{key:"obtenerTarjetas",value:function(e){var n=this;this.animation="hidden",this.apiServicio.getTarjetas(e).subscribe((function(e){if(n.tarjetas=[e],console.log(n.tarjetas),null!=n.tarjetas[0]){n.hayTarjetas="Tus tarjetas";var i,o=t(n.tarjetas[0]);try{for(o.s();!(i=o.n()).done;){var a=i.value;a.numero=n.servicioAES.get(n.keyJScrypto,a.numero),a.cvv=n.servicioAES.get(n.keyJScrypto,a.cvv),a.fecha=n.servicioAES.get(n.keyJScrypto,a.fecha),a.color="visa"==a.tipo?"background:#1c3a24;":"background:#464545;"}}catch(r){o.e(r)}finally{o.f()}n.spinner=!1,n.animation="show"}else console.log("no tiene tarjetas agregadas"),n.hayTarjetas="No tiene tarjetas agregadas",n.spinner=!1,n.animation="show"}),(function(t){console.log("no tiene tarjetas agregadas"),n.hayTarjetas="No tiene tarjetas agregadas"}))}},{key:"regresar",value:function(){document.getElementById("volver2").disabled=!0}},{key:"nuevaTarjeta",value:function(){this.lista.closeSlidingItems(),this.router.navigate(["agregar-tarjeta"],{state:{tarjeta:"0",pantalla:2}})}},{key:"seleccionar",value:function(e){var n=e.detail.value;this.oculto=0==this.tarjetaSeleccionada;var i,o=t(this.tarjetas[0]);try{for(o.s();!(i=o.n()).done;){var a=i.value;a.numero==n&&(this.tarjet=a)}}catch(r){o.e(r)}finally{o.f()}console.log(this.tarjet)}},{key:"EvnetotarjetaSeleccionada",value:function(t){this.tarjetaSeleccionada=t}},{key:"siguiente",value:function(){if(null==this.carrito.idpromocion){var e=[],n=0;if(null==this.establecimientosCoincidencia)n=0;else{var i,o,a=t(this.establecimientosCoincidencia);try{for(a.s();!(i=a.n()).done;){var r=i.value;r.idsociocomercial!=this.carrito.bebidas[0].idsociocomercial&&r.total>this.t&&this.tiendasAhorro.push(r.total)}}catch(c){a.e(c)}finally{a.f()}n=0==(e=this.tiendasAhorro.sort()).length?0:e[e.length-1]-this.t,console.log(e),console.log("prom"+n),console.log(e[e.length-1]),(o=0==n||n<0?0:n/2)<0&&(o=0),this.apiServicio.setStorage("ahorro",o.toFixed(2))}}else this.apiServicio.setStorage("ahorro",0);this.router.navigate(["finalizar-compra"],{state:{carrito:this.carrito,total:this.total,tarjeta:this.tarjet,delivery:this.delivery}})}},{key:"editar",value:function(t){console.log("editar "+t),this.lista.closeSlidingItems(),this.router.navigate(["agregar-tarjeta"],{state:{tarjeta:t,pantalla:2}})}},{key:"eliminar",value:function(t){var e=this;console.log("eliminar "+t),this.lista.closeSlidingItems(),this.apiServicio.eliminarTarjeta(t.idtarjeta).then((function(t){console.log("tarjeta eliminada"),console.log(t),e.ionViewDidEnter()})).catch((function(t){console.log("error al eliminar tarjeta"),console.log(t)}))}},{key:"tutorial",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.modalController.create({component:d.a,cssClass:"small-modal",componentProps:{pagina:2}});case 2:return e=t.sent,t.next=5,e.present();case 5:return t.next=7,e.onDidDismiss();case 7:n=t.sent,i=n.data,console.log(i),this.apiServicio.setStorage("guia_tarjetas",1);case 10:case"end":return t.stop()}}),t,this)})))}},{key:"googleAnalytics",value:function(){this.firebaseAnalytics.logEvent("pantalla",{pantalla:"pasarela_Tarjetas"}).then((function(t){console.log(t),console.log("firebase ok")})).catch((function(t){console.log(t),console.log("firebase no")}))}},{key:"n1",value:function(t){return String(t).substring(0,4)}},{key:"n2",value:function(t){return String(t).substring(4,5)}},{key:"n3",value:function(t){return String(t).substring(12)}}])&&i(o.prototype,a),r&&i(o,r),e}(),x.\u0275fac=function(t){return new(t||x)(g.Ib(s.g),g.Ib(f.a),g.Ib(l.lb),g.Ib(p.a),g.Ib(h.a),g.Ib(l.kb),g.Ib(s.a))},x.\u0275cmp=g.Cb({type:x,selectors:[["app-tarjetas"]],viewQuery:function(t,e){var n;1&t&&g.zc(m,!0),2&t&&g.jc(n=g.Vb())&&(e.lista=n.first)},decls:21,vars:5,consts:[["slot","start",2,"color","#f3f2ed"],["id","volver2",3,"click"],[1,"title-toolbar"],["size","large","slot","end","name","help-circle-outline",2,"color","#ffff","margin-right","10px",3,"click"],["slot","end",1,"label-toolbar"],[4,"ngIf"],["no-border","","style","opacity: 0",4,"ngIf"],[1,"btn-add",3,"click"],["name","add"],["slot","end","fill","clear","id","btn-siguiente","mode","ios",3,"disabled","click"],["name","chevron-forward-outline",1,"icono-inferiores"],[1,"div-spinner-style"],["name","circles"],["no-border","",2,"opacity","0"],["lista",""],[3,"ngModel","ngModelChange","ionChange"],[4,"ngFor","ngForOf"],["src","./assets/Iconos/chip.png",1,"chip"],["id","tipo-tarjeta",1,"tipo-tarjeta",3,"src"],[1,"numero-tarjeta"],[1,"titulo-titular"],[1,"titular"],[1,"titulo-fecha"],[1,"fecha"],[1,"select-tarjeta"],["slot","start","color","success",3,"value","click"],["side","start"],[3,"click"],["slot","icon-only","name","create-sharp"],["side","end"],["slot","icon-only","name","trash"]],template:function(t,e){1&t&&(g.Mb(0,"ion-header"),g.Mb(1,"ion-toolbar"),g.Mb(2,"ion-buttons",0),g.Mb(3,"ion-back-button",1),g.Ub("click",(function(){return e.regresar()})),g.Lb(),g.Lb(),g.Mb(4,"ion-title",2),g.uc(5,"M\xe9todo de pago"),g.Lb(),g.Mb(6,"ion-icon",3),g.Ub("click",(function(){return e.tutorial()})),g.Lb(),g.Mb(7,"ion-label",4),g.uc(8),g.Lb(),g.Lb(),g.Lb(),g.Mb(9,"ion-content"),g.Mb(10,"h3"),g.uc(11),g.Lb(),g.sc(12,v,3,0,"ion-row",5),g.sc(13,M,4,3,"ion-list",6),g.Mb(14,"ion-fab-button",7),g.Ub("click",(function(){return e.nuevaTarjeta()})),g.Jb(15,"ion-icon",8),g.Lb(),g.Lb(),g.Mb(16,"ion-footer"),g.Mb(17,"ion-toolbar"),g.Mb(18,"ion-button",9),g.Ub("click",(function(){return e.siguiente()})),g.uc(19,"Siguiente"),g.Jb(20,"ion-icon",10),g.Lb(),g.Lb(),g.Lb()),2&t&&(g.yb(8),g.wc("S/ ",e.total.toFixed(2),""),g.yb(3),g.vc(e.hayTarjetas),g.yb(1),g.ec("ngIf",e.spinner),g.yb(1),g.ec("ngIf",!e.spinner),g.yb(5),g.fc("disabled",e.oculto))},directives:[l.v,l.fb,l.i,l.e,l.f,l.eb,l.w,l.G,l.q,r.k,l.s,l.t,l.h,l.Q,l.Z,l.H,l.M,l.qb,c.h,c.k,r.j,l.F,l.B,l.p,l.L,l.ob,l.E,l.D],styles:["ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background:#108b3c}.title-toolbar[_ngcontent-%COMP%]{color:#fff;font-family:Gotham-Medium;font-size:23px}.label-toolbar[_ngcontent-%COMP%]{color:#fff;font-family:SFCompactText-Medium;font-size:20px;margin-right:10px}ion-content[_ngcontent-%COMP%]{--background:#121212}ion-list[_ngcontent-%COMP%]{background:#121212}ion-item[_ngcontent-%COMP%]{--background:#121212;--border-color:#121212}h3[_ngcontent-%COMP%]{color:#f3f2ed;margin-top:30px;margin-left:20px;font-family:Gotham-Medium}#btn-anterior[_ngcontent-%COMP%]{left:0}#btn-anterior[_ngcontent-%COMP%], #btn-siguiente[_ngcontent-%COMP%]{--color:#fff;font-family:SFCompactText-Medium;font-size:20px;height:50px}#btn-siguiente[_ngcontent-%COMP%]{right:0}.iconos-inferiores[_ngcontent-%COMP%]{color:#f3f2ed}.chip[_ngcontent-%COMP%]{width:70px;left:10px;top:20px}.chip[_ngcontent-%COMP%], .tipo-tarjeta[_ngcontent-%COMP%]{height:30px;position:absolute}.tipo-tarjeta[_ngcontent-%COMP%]{width:40px;right:20px;top:10px}div[_ngcontent-%COMP%]{border-radius:10px;width:100%;height:230px}ion-col[_ngcontent-%COMP%], ion-row[_ngcontent-%COMP%]{--padding:0;--margin:0}.numero-tarjeta[_ngcontent-%COMP%]{font-family:Gotham-Medium;color:#fff;top:45%;font-size:28px;position:relative;text-align:center;align-items:center;align-content:center;margin:auto}.titular[_ngcontent-%COMP%]{font-size:16px;bottom:20px}.titular[_ngcontent-%COMP%], .titulo-titular[_ngcontent-%COMP%]{color:#fff;font-family:SFUIDisplay-Regular;position:absolute;left:20px}.titulo-titular[_ngcontent-%COMP%]{font-size:14px;bottom:40px}.fecha[_ngcontent-%COMP%]{font-size:16px;right:40px;bottom:20px}.fecha[_ngcontent-%COMP%], .titulo-fecha[_ngcontent-%COMP%]{color:#fff;font-family:SFUIDisplay-Regular;position:absolute}.titulo-fecha[_ngcontent-%COMP%]{font-size:14px;right:20px;bottom:40px}.select-tarjeta[_ngcontent-%COMP%]{color:#fff}.btn-add[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;left:85%;bottom:30px;--background:#108b3c}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%], ion-item-option[_ngcontent-%COMP%]{--background:#121212}.div-spinner-style[_ngcontent-%COMP%]{width:100%;text-align:center;height:50px;display:flex;justify-content:center;align-items:center}.div-spinner-style[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{color:#108b3c}","@media screen and (device-width:360px) and (device-height:640px) and (-webkit-device-pixel-ratio:4) and (orientation:portrait){.title-toolbar[_ngcontent-%COMP%]{font-size:23px}.label-toolbar[_ngcontent-%COMP%]{font-size:20px}}@media screen and (device-width:360px) and (device-height:640px) and (-webkit-device-pixel-ratio:3) and (orientation:portrait){.title-toolbar[_ngcontent-%COMP%]{font-size:21px}.label-toolbar[_ngcontent-%COMP%]{font-size:18px}}@media screen and (device-width:320px) and (device-height:640px) and (-webkit-device-pixel-ratio:2) and (orientation:portrait){.title-toolbar[_ngcontent-%COMP%]{font-size:20px}.label-toolbar[_ngcontent-%COMP%]{font-size:17px}}@media screen and (device-width:320px) and (device-height:640px) and (-webkit-device-pixel-ratio:1) and (orientation:portrait){.title-toolbar[_ngcontent-%COMP%]{font-size:20px}.label-toolbar[_ngcontent-%COMP%]{font-size:17px}}@media only screen and (min-device-width:320px) and (max-device-width:480px) and (-webkit-min-device-pixel-ratio:2) and (orientation:portrait){.title-toolbar[_ngcontent-%COMP%]{font-size:21px}.label-toolbar[_ngcontent-%COMP%]{font-size:18px}}@media only screen and (min-device-width:320px) and (max-device-width:568px) and (-webkit-min-device-pixel-ratio:2) and (orientation:portrait){.title-toolbar[_ngcontent-%COMP%]{font-size:21px}.label-toolbar[_ngcontent-%COMP%]{font-size:18px}}@media only screen and (min-device-width:375px) and (max-device-width:667px) and (-webkit-min-device-pixel-ratio:2) and (orientation:portrait){.title-toolbar[_ngcontent-%COMP%]{font-size:22px}.label-toolbar[_ngcontent-%COMP%]{font-size:19px}}@media only screen and (min-device-width:414px) and (max-device-width:736px) and (-webkit-min-device-pixel-ratio:3) and (orientation:portrait){.title-toolbar[_ngcontent-%COMP%]{font-size:22px}.label-toolbar[_ngcontent-%COMP%]{font-size:19px}}@media only screen and (min-device-width:375px) and (max-device-width:812px) and (-webkit-min-device-pixel-ratio:3) and (orientation:portrait){.title-toolbar[_ngcontent-%COMP%]{font-size:22px}.label-toolbar[_ngcontent-%COMP%]{font-size:19px}}"],data:{animation:[Object(u.j)("visibilityChanged",[Object(u.g)("show",Object(u.h)({opacity:1})),Object(u.g)("hidden",Object(u.h)({opacity:0})),Object(u.i)("* => show",Object(u.e)("1000ms ease-in-out")),Object(u.i)("* => hidden",Object(u.e)("100ms ease-in-out"))])]}}),x)}],k=((j=function t(){n(this,t)}).\u0275mod=g.Gb({type:j}),j.\u0275inj=g.Fb({factory:function(t){return new(t||j)},imports:[[s.i.forChild(O)],s.i]}),j),w=((C=function t(){n(this,t)}).\u0275mod=g.Gb({type:C}),C.\u0275inj=g.Fb({factory:function(t){return new(t||C)},providers:[p.a],imports:[[r.c,c.d,l.gb,k]]}),C)}}])}();